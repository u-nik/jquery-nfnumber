/**
 * jQuery Plugin zur Formatierung von Zahlenwerten innerhalb normaler Textfelder. Bei HTML5 Input Feldern vom Typ
 * "number" funktioniert die Formatierung nicht, jedoch das Ver채ndern des Wertes 체ber die Pfeil- und +/- Tasten.
 *
 * @todo Beliebige Zeichen ab von "." und "," f체r Seperator und Decsign funktionieren nicht, da deren Eingabe verweigert
 * wird. Da m체sste der "keydown" Handler noch verbessert werden.
 *
 * @author Niklas Funke <niklas.funke@gmail.com>
 * @date: 09.03.12
 * @version 0.1
 *
 * Copyright (c) 2012, Niklas Funke
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS
 * OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(a){var b={precision:2,step:0,max:null,min:null,decsign:".",seperator:"",shiftmulti:100,selector:"input.nfnumbers",initformat:true,prefix:"",suffix:"",formmode:"raw"};var c={init:function(f){var g=a(this);var h=a.extend({},b,f);d.setStep(h);c.destroy(f);g.on("change.nfnumber",h.selector,h,e.change);g.on("blur.nfnumber",h.selector,h,e.change);g.on("keydown.nfnumber",h.selector,h,e.keydown);if(h.formmode=="raw"){g.find(h.selector).each(function(b,c){var e=a(c);var f=d.uuid();e.after(e.clone(false).attr("type","hidden").addClass("nfnumber-hidden nfnumber-uuid-"+f));e.data({"nfnumber-uuid":f}).attr("name",null)})}if(h.initformat){g.find(h.selector).trigger("change.nfnumber",true)}return this},destroy:function(c){var d=a(this);var f=a.extend({},b,c);d.find(f.selector).each(function(b,c){var d=a(c);var e=a(".nfnumber-uuid-"+d.data("nfnumber-uuid"));if(e){d.attr("name",e.attr("name")).val(e.val());e.remove()}});d.off("change.nfnumber",f.selector,e.change);d.off("blur.nfnumber",f.selector,e.change);d.off("keydown.nfnumber",f.selector,e.keydown);return this},toString:function(a,b){var c="",e=b.precision;a=d.round(a,e);var f=""+a;var g=f.indexOf(".");f+=(g==-1?".":"")+Math.pow(10,e).toString().substring(1);var h=a<0;if(h){f=f.substring(1)}g=f.indexOf(".");if(g==-1){g=f.length}else{c=b.decsign+f.substr(g+1,e)}while(g>0){if(g-3>0){c=b.seperator+f.substring(g-3,g)+c}else{c=f.substring(0,g)+c}g-=3}return b.prefix+(h?"-":"")+c+b.suffix},toFloat:function(b,c){if(typeof b=="string"){if(c.prefix!=""){b=d.replace(c.prefix,"",b)}if(c.suffix!=""){b=d.replace(c.suffix,"",b)}if(c.seperator!=""&&b.indexOf(c.seperator)!=-1){b=d.replace(c.seperator,"",b)}if(c.decsign!="."&&b.indexOf(c.decsign)!=-1){b=d.replace(c.decsign,".",b)}}else{b="0"}var e=parseFloat(b);if(e==Number.NaN){a.error("Invalid Number: "+b);return 0}return e}};var d={setStep:function(a){if(a.step==0&&a.precision>0){a.step=1/Math.pow(10,a.precision)}},round:function(a,b){var c=Math.pow(10,b);a=Math.round(a*c)/c;return a},replace:function(a,b,c){return c.split(a).join(b)},uuid:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},normalize:function(a,b){a=Math.ceil(d.round(a/b.step,b.precision))*b.step;a=d.round(a,b.precision);a=b.max!=null?Math.min(a,b.max):a;a=b.min!=null?Math.max(a,b.min):a;return a}};var e={change:function(b,e){var f=a(this);var g=a.extend({},b.data,f.data());d.setStep(g);if(e!=undefined&&e&&g.formmode=="raw"){var h=Math.max(parseFloat(f.val()),g.min)}else{var h=c.toFloat(f.val(),g)}h=d.normalize(h,g);if(g.formmode=="raw"){a(".nfnumber-uuid-"+f.data("nfnumber-uuid")).val(h)}f.val(c.toString(h,g));return false},keydown:function(b){var e=a(this);var f=a.extend({},b.data,e.data());d.setStep(f);var g=c.toFloat(e.val(),f);var h=g;var i=false;switch(b.which){case 38:case 107:if(b.shiftKey){g=g+f.shiftmulti*f.step}else{g=g+f.step}g=d.round(g,f.precision);break;case 40:case 109:if(b.shiftKey){g=g-f.shiftmulti*f.step}else{g=g-f.step}g=d.round(g,f.precision);break;case 32:if(b.shiftKey){g=f.min!=null?f.min:0}else{g=f.max!=null?f.max:0}break;case 8:case 9:case 13:case 35:case 36:case 37:case 39:case 46:return true;default:if(!b.shiftKey){if(b.which>=48&&b.which<=57){return true}else if(b.which>=96&&b.which<=105){return true}else if(b.which==110||b.which==188||b.which==190){return true}}console.log(b.which);return false}if(g!=h){g=d.normalize(g,f);if(f.formmode=="raw"){a(".nfnumber-uuid-"+e.data("nfnumber-uuid")).val(g)}e.val(c.toString(g,f))}return i}};a.fn.nfnumber=function(b){if(c[b]){return c[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return c.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.nfnumber")}return this}})(jQuery)