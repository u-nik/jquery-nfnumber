/**
 * @author Niklas Funke <niklas.funke@gmail.com>
 * @date: 13.03.12
 * @version 0.3
 * @license MIT license
 */
(function(a){var b={precision:2,step:0,max:null,min:null,decsign:".",seperator:"",shiftmulti:100,initformat:true,prefix:"",suffix:"",formmode:"raw",change:null,create:function(){},destroy:function(){},reachmax:null,reachmin:null};var c={reachedMax:false,reachedMin:false,invalidValue:0};var d={init:function(c){var g=a(this);var h=a.extend({},b,c);e.setStep(h);d.destroy(c);g.on("change.nfnumber",h,f.change);g.on("blur.nfnumber",h,f.change);g.on("keydown.nfnumber",h,f.keydown);g.on("create.nfnumber",h,h.create);g.on("destroy.nfnumber",h,h.destroy);if(h.formmode=="raw"){g.each(function(b,c){var d=a(c);var e=d.clone(false).attr("type","hidden").addClass("nfnumber-hidden");d.after(e).data("nfnumber",{hidden:e})})}if(h.initformat){g.trigger("change.nfnumber",true)}g.trigger("oncreate.nfnumber");return this},destroy:function(b){var c=a(this);c.each(function(b,c){var e=a(c);var f=e.data("nfnumber");if(f!=undefined&&f.hidden){var g=f.hidden;e.attr("name",g.attr("name")).val(g.val());e.getNumber=function(){return d.toFloat(this.value)};g.remove();e.removeData("nfnumber")}});c.trigger("ondestroy.nfnumber");c.off(".nfnumber",f.change);return this},value:function(){var b=a(this);var c=b.data("nfnumber");if(c!=undefined&&c.hidden!=undefined){return c.hidden.val()}else{return a(this).val()}}};var e={setStep:function(a){if(a.step==0&&a.precision>0){a.step=1/Math.pow(10,a.precision)}},round:function(a,b){var c=Math.pow(10,b);a=Math.round(a*c)/c;return a},replace:function(a,b,c){return c.split(a).join(b)},normalize:function(a,b){c.reachedMax=false;c.reachedMin=false;a=Math.ceil(e.round(a/b.step,b.precision))*b.step;a=e.round(a,b.precision);var d=a;a=b.max!=null?Math.min(a,b.max):a;a=b.min!=null?Math.max(a,b.min):a;if(d<a){c.reachedMin=true;c.invalidValue=d}else if(d>a){c.reachedMax=true;c.invalidValue=d}return a},toString:function(a,b){var c="",d=b.precision;a=e.round(a,d);var f=""+a;var g=f.indexOf(".");f+=(g==-1?".":"")+Math.pow(10,d).toString().substring(1);var h=a<0;if(h){f=f.substring(1)}g=f.indexOf(".");if(g==-1){g=f.length}else{c=b.decsign+f.substr(g+1,d)}while(g>0){if(g-3>0){c=b.seperator+f.substring(g-3,g)+c}else{c=f.substring(0,g)+c}g-=3}return b.prefix+(h?"-":"")+c+b.suffix},toFloat:function(b,c){if(typeof b=="string"){if(c.prefix!=""){b=e.replace(c.prefix,"",b)}if(c.suffix!=""){b=e.replace(c.suffix,"",b)}if(c.seperator!=""&&b.indexOf(c.seperator)!=-1){b=e.replace(c.seperator,"",b)}if(c.decsign!="."&&b.indexOf(c.decsign)!=-1){b=e.replace(c.decsign,".",b)}}else{b="0"}var d=parseFloat(b);if(d==Number.NaN){a.error("Invalid Number: "+b);return 0}return d},changeValue:function(b,d,f){d=e.normalize(d,f);if(f.formmode=="raw"){a(f.nfnumber.hidden).val(d)}if(typeof f.change=="function"){var g=f.change.call(b,d,f);if(a.isNumeric(g)){d=g}}b.val(e.toString(d,f));if(c.reachedMax&&f.reachmax!=null){f.reachmax.call(b,d,c.invalidValue,f)}else if(c.reachedMin&&f.reachmin!=null){f.reachmin.call(b,d,c.invalidValue,f)}}};var f={change:function(b,c){var d=a(this),f;var g=a.extend({},b.data,d.data());e.setStep(g);if(c!=undefined&&g.formmode=="raw"){f=Math.max(parseFloat(d.val()),g.min)}else{f=e.toFloat(d.val(),g)}e.changeValue(d,f,g);return false},keydown:function(b){var c=a(this);var d=a.extend({},b.data,c.data());e.setStep(d);var f=e.toFloat(c.val(),d);var g=f;var h=false;switch(b.which){case 38:if(b.shiftKey){f=f+d.shiftmulti*d.step}else{f=f+d.step}f=e.round(f,d.precision);break;case 40:if(b.shiftKey){f=f-d.shiftmulti*d.step}else{f=f-d.step}f=e.round(f,d.precision);break;case 32:if(b.shiftKey){f=d.min!=null?d.min:0}else{f=d.max!=null?d.max:0}break;case 8:case 9:case 13:case 35:case 36:case 37:case 39:case 46:case 107:case 109:return true;default:if(!b.shiftKey){if(b.which>=48&&b.which<=57){return true}else if(b.which>=96&&b.which<=105){return true}else if(b.which==110||b.which==188){return true}else if(b.which==190||b.which==189){return true}}console.log(b.which);return false}if(f!=g){e.changeValue(c,f,d)}return h}};a.fn.nfnumber=function(b){if(d[b]){return d[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return d.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.nfnumber")}return this}})(jQuery)